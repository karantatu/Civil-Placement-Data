<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Civil Placement Data</title>

<style>
:root{
  --brand:#0f4c81;
  --muted:#6b7280;
  --bg:#f6f8fb;
  --card:#ffffff;
  --accent:#2563eb;
  --radius:10px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  background:var(--bg);
  color:#0b1220;
}

/* Main header */
header{
  background:linear-gradient(90deg,var(--brand),#143f6b);
  color:white;
  padding:20px 16px;
  text-align:center;
  position:sticky;
  top:0;
  z-index:999;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
}
header h1{ margin:0; font-size:22px; }
header p{ margin:6px 0 0; font-size:13px; opacity:0.9; }

main{
  max-width:1100px;
  margin:0 auto;
  padding:16px;
}

/* Search box */
#searchBox{
  width:100%;
  padding:12px 14px;
  font-size:15px;
  border-radius:8px;
  border:1px solid #d0d7e1;
  margin-bottom:18px;
}
#searchBox:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 2px rgba(37,99,235,0.15);
}

.batch{ margin-bottom:28px; }
.batch-header{
  font-size:18px;
  color:var(--brand);
  font-weight:600;
  margin-bottom:14px;
}

.division-card{
  background:var(--card);
  border-radius:var(--radius);
  padding:14px;
  box-shadow:0 4px 14px rgba(12,20,40,0.06);
  margin-bottom:14px;
}

.division-title{
  font-size:15px;
  margin-bottom:6px;
  font-weight:600;
}

/* Table wrapper */
.table-wrap{
  overflow:auto;
  border-radius:8px;
  max-height:400px; /* optional: scrollable if too tall */
}

table{
  width:100%;
  border-collapse:collapse;
  min-width:880px;
}

th, td{
  padding:10px 12px;
  text-align:left;
  font-size:14px;
  border-bottom:1px solid #eef2f6;
  word-wrap:break-word;
  white-space:normal;
  cursor:default;
}

th{
  background:#eef6ff;
  font-weight:600;
  position:sticky;
  top:0;
  z-index:5;
  cursor:pointer;
}

.btn{
  background:var(--accent);
  color:white;
  padding:6px 10px;
  border-radius:7px;
  font-size:13px;
  text-decoration:none;
  display:inline-block;
}

.empty{
  color:var(--muted);
  font-style:italic;
}

.record-count{
  font-size:14px;
  color:var(--muted);
  margin-bottom:6px;
}

@media (max-width:880px){
  th, td{
    padding:8px 10px;
    font-size:13px;
  }
  table{
    min-width:720px;
  }
}
</style>
</head>

<body>
<header>
  <h1>Civil Placement Data</h1>
  <p>Batch-wise placement & higher-study records</p>
</header>

<main id="app">
  <div style="margin-top:14px; text-align:center;">
    <input id="searchBox" type="text" placeholder="Search by Name, Roll No., Company, College…" style="width:92%; max-width:420px; padding:10px 14px; font-size:14px; border-radius:8px; border:1px solid #ccc;">
  </div>
  <p style="color:var(--muted); text-align:center;">Loading data…</p>
</main>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzZktXlHMkMdYk20t7InRdMe4TgdALW7jeulQEV53Wg1rSL8ruteB8VyE1FqvlZ3vay_Q/exec";
let GLOBAL_DATA = {};

function escapeHtml(s){ return String(s||"").replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function isUrl(s){ return typeof s === "string" && /^https?:\/\//i.test(s.trim()); }

function buildTable(rows){
  let html = `<div class="record-count">Total Records: ${rows.length}</div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th data-key="sr">Sr. No.</th>
            <th data-key="roll">Roll No.</th>
            <th data-key="name">Name</th>
            <th data-key="company">Company</th>
            <th>Job Proof</th>
            <th data-key="college">Higher Study College</th>
            <th>Higher Study Proof</th>
          </tr>
        </thead>
        <tbody>
  `;
  if(rows.length===0) html += `<tr><td class="empty" colspan="7">No records</td></tr>`;

  rows.forEach(r=>{
    html += `
      <tr>
        <td>${r.sr||""}</td>
        <td>${r.roll||""}</td>
        <td title="${escapeHtml(r.name)}">${escapeHtml(r.name).length>20?escapeHtml(r.name).slice(0,20)+'…':escapeHtml(r.name)}</td>
        <td title="${escapeHtml(r.company)}">${escapeHtml(r.company||"").length>15?escapeHtml(r.company).slice(0,15)+'…':escapeHtml(r.company||"")}</td>
        <td>${isUrl(r.companyLink)?`<a class="btn" target="_blank" href="${r.companyLink}">Open</a>`:""}</td>
        <td title="${escapeHtml(r.college)}">${escapeHtml(r.college||"").length>15?escapeHtml(r.college).slice(0,15)+'…':escapeHtml(r.college||"")}</td>
        <td>${isUrl(r.collegeLink)?`<a class="btn" target="_blank" href="${r.collegeLink}">Open</a>`:""}</td>
      </tr>`;
  });

  html += `</tbody></table></div>`;
  return html;
}

function makeSortable(table){
  const headers = table.querySelectorAll("th[data-key]");
  headers.forEach(header=>{
    let asc = true;
    header.addEventListener("click", ()=>{
      const tbody = table.querySelector("tbody");
      const rows = Array.from(tbody.querySelectorAll("tr")).filter(r => !r.classList.contains("empty"));
      rows.sort((a,b)=>{
        let aText = a.children[header.cellIndex].textContent.trim().toLowerCase();
        let bText = b.children[header.cellIndex].textContent.trim().toLowerCase();
        if(!isNaN(aText) && !isNaN(bText)) return asc?aText-bText:bText-aText;
        return asc?aText.localeCompare(bText):bText.localeCompare(aText);
      });
      rows.forEach(r=>tbody.appendChild(r));
      asc = !asc;
    });
  });
}

function render(data){
  const root = document.getElementById("app");
  root.innerHTML = `<div style="margin-top:14px; text-align:center;">
    <input id="searchBox" type="text" placeholder="Search by Name, Roll No., Company, College…" style="width:92%; max-width:420px; padding:10px 14px; font-size:14px; border-radius:8px; border:1px solid #ccc;">
  </div>`;

  const batches = ["22-23","23-24","24-25"];
  batches.forEach(batch=>{
    const bData = data[batch];
    if(!bData) return;

    const sec = document.createElement("div");
    sec.className = "batch";
    sec.innerHTML = `<div class="batch-header">Batch ${batch}</div>`;

    ["A","B"].forEach(div=>{
      const rows = Array.isArray(bData[div])?bData[div]:[];
      const card = document.createElement("div");
      card.className = "division-card";
      card.innerHTML = `<div class="division-title">Division ${div}</div>` + buildTable(rows);
      sec.appendChild(card);
      makeSortable(card.querySelector("table"));
    });

    root.appendChild(sec);
  });

  document.getElementById("searchBox").addEventListener("input", applySearch);
}

function applySearch(){
  const q = document.getElementById("searchBox").value.trim().toLowerCase();
  const rows = document.querySelectorAll("tbody tr");
  rows.forEach(row=>{
    row.style.display = row.textContent.toLowerCase().includes(q)?"":"none";
  });
}

function loadData(){
  fetch(API_URL)
    .then(res=>res.json())
    .then(data=>{
      GLOBAL_DATA = data;
      render(data);
    })
    .catch(err=>{
      document.getElementById("app").innerHTML = `<p style="color:red; text-align:center;">Failed to load data</p>`;
    });
}

loadData();
</script>
</body>
</html>
